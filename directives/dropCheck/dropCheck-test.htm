<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>dropCheck Unit Tests</title>
    <link rel="stylesheet" href="//code.jquery.com/qunit/qunit-1.21.0.css">
</head>

<body>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <script src="//code.jquery.com/qunit/qunit-1.21.0.js"></script>
    <script src="http://agentanswercenter.directv.com/en-us/res/system/js/angular.min.1.2.11.js"></script>
    <script src="http://agentanswercenter.directv.com/en-us/res/system/js/jquery.js"></script>
    <script src="dropCheck.js"></script>
    <script>
    var getAtts = function(id) {
        var atts = {};
        Array.prototype.slice.call(document.getElementById(id).attributes).forEach(function(item) {
            atts[item.name]= item.value;
        });
        return atts;
    }
    QUnit.test("checker/dropdown - Click adds class \"checked\" to div", function(assert) {
        var fixture = $("#qunit-fixture");

        fixture.append("<label id='testLabel' checker></label><input /><div></div>");

        var testAtts = getAtts("testLabel"),
            testEl = $("#testLabel");

        dropCheck(testEl, testAtts);

        testEl.trigger("click");
        assert.ok(testEl.next().next().hasClass("checked"), "The div's class is " + testEl.next().next().attr("class"));
    });

    QUnit.test("checker - Only one element should have class \"checked\" after multiple clicks", function(assert) {
        var fixture = $("#qunit-fixture");

        fixture.append("<label id='testLabel' checker></label><input /><div></div><label id='testLabel2' checker></label><input /><div></div>");

        var testAtts = getAtts("testLabel"),
            testAtts2 = getAtts("testLabel2"),
            testEl = $("#testLabel"),
            testEl2 = $("#testLabel2");

        dropCheck(testEl, testAtts);
        dropCheck(testEl2, testAtts2);

        testEl.trigger("click");
        testEl2.trigger("click");
        assert.equal($(".checked").length, 1, "Total number of elements with class \"checked\" = " + $(".checked").length);
    });

    QUnit.test("dropdown - All elements should have class \"checked\" after multiple clicks", function(assert) {
        var fixture = $("#qunit-fixture");

        fixture.append("<label id='testLabel' dropdown></label><input /><div></div><label id='testLabel2' dropdown></label><input /><div></div>");

        var testAtts = getAtts("testLabel"),
            testAtts2 = getAtts("testLabel2"),
            testEl = $("#testLabel"),
            testEl2 = $("#testLabel2");

        dropCheck(testEl, testAtts);
        dropCheck(testEl2, testAtts2);

        testEl.trigger("click");
        testEl2.trigger("click");
        assert.equal($(".checked").length, 2, "Total number of elements with class \"checked\" = " + $(".checked").length);
    });

    QUnit.test("checker/dropdown - IE Fix is triggered", function(assert) {
        var fixture = $("#qunit-fixture");

        fixture.append("<label id='testLabel' checker></label><input /><div></div>");

        var testAtts = getAtts("testLabel"),
            testEl = $("#testLabel");

        dropCheck(testEl, testAtts);

        testAtts = getAtts("testLabel");

        assert.deepEqual(testAtts.iefixed, "false", "Attribute iefixed is false after instatiation and before click");

        testEl.trigger("click");

        testAtts = getAtts("testLabel")

        assert.deepEqual(testAtts.iefixed, "true",  "Attribute iefixed is true after click");
    });
    </script>
</body>

</html>
